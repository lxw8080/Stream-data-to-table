# 客户类型标记工具 - 使用指南

## 🚀 三种使用方法

### 方法1：自动查找文件（最简单）⭐

直接运行脚本，不需要指定文件名：

```powershell
python mark_customer_type.py
```

**工作原理：**
- 自动在当前目录查找Excel文件
- 如果只有一个Excel文件，自动选择
- 如果有多个Excel文件，会显示列表让你选择

**示例输出：**
```
自动选择文件: 租机登记表.xlsx

============================================================
客户类型标记工具
============================================================
✓ 成功加载文件: 租机登记表.xlsx
...
```

---

### 方法2：使用批处理文件（推荐）

双击运行 `mark_customer.bat` 文件，或在PowerShell中：

```powershell
.\mark_customer.bat
```

**优点：**
- 一键运行
- 自动处理编码问题
- 处理完成后暂停，方便查看结果

---

### 方法3：指定文件路径（精确控制）

```powershell
# 基本用法（覆盖原文件）
python mark_customer_type.py "租机登记表.xlsx"

# 保存到新文件（推荐，保留原文件）
python mark_customer_type.py "租机登记表.xlsx" -o "标记结果.xlsx"

# 指定工作表名称
python mark_customer_type.py "租机登记表.xlsx" -s "Sheet1"

# 完整参数
python mark_customer_type.py "租机登记表.xlsx" -s "Sheet1" -o "标记结果.xlsx"
```

---

## 📋 完整的使用流程

### 步骤1：准备Excel文件

确保你的Excel文件符合以下要求：

```
文件结构：
├── 第1行：标题行
├── 第2行：表头行
└── 第3行及以后：数据行

关键列：
├── C列（索引2）：订单创建日期
├── G列（索引6）：客户身份证号
└── T列（索引19）：客户类型标记（工具会填充）
```

### 步骤2：运行工具

**选择一种方法运行：**

#### 选项A：自动模式（最简单）
```powershell
python mark_customer_type.py
```

#### 选项B：批处理文件
```powershell
.\mark_customer.bat
```

#### 选项C：指定文件
```powershell
python mark_customer_type.py "租机登记表.xlsx" -o "标记结果.xlsx"
```

### 步骤3：查看结果

打开Excel文件，检查：
- ✅ T列是否填充了"新增"或"存量"
- ✅ 新增客户是否为浅绿色背景
- ✅ 存量客户是否为浅黄色背景

---

## 🧪 测试工具

在处理真实数据前，建议先测试：

### 自动化测试（推荐）

```powershell
.\test_run.bat
```

这会：
1. 生成测试数据（`测试_租机登记表.xlsx`）
2. 运行标记工具
3. 输出结果到 `测试结果.xlsx`

### 手动测试

```powershell
# 步骤1：生成测试数据
python test_marker.py

# 步骤2：运行标记工具
python mark_customer_type.py "测试_租机登记表.xlsx" -o "测试结果.xlsx"

# 步骤3：打开 "测试结果.xlsx" 查看结果
```

**预期结果：**
- 50条2024年订单 → 全部为"存量"（黄色）
- 30条2025年老客户订单 → 全部为"存量"（黄色）
- 20条2025年新客户订单 → 全部为"新增"（绿色）

---

## 💡 实用技巧

### 技巧1：保留原文件

使用 `-o` 参数保存到新文件，避免覆盖原数据：

```powershell
python mark_customer_type.py "租机登记表.xlsx" -o "租机登记表_已标记.xlsx"
```

### 技巧2：处理多个工作表

如果Excel文件有多个工作表，使用 `-s` 参数指定：

```powershell
python mark_customer_type.py "租机登记表.xlsx" -s "2025年数据"
```

### 技巧3：批量处理

创建一个批处理脚本处理多个文件：

```batch
@echo off
python mark_customer_type.py "1月数据.xlsx" -o "1月数据_已标记.xlsx"
python mark_customer_type.py "2月数据.xlsx" -o "2月数据_已标记.xlsx"
python mark_customer_type.py "3月数据.xlsx" -o "3月数据_已标记.xlsx"
pause
```

### 技巧4：查看帮助

```powershell
python mark_customer_type.py -h
```

---

## 🎯 常见使用场景

### 场景1：首次使用

```powershell
# 1. 先测试
.\test_run.bat

# 2. 查看测试结果，确认功能正确

# 3. 处理真实数据（保存到新文件）
python mark_customer_type.py "租机登记表.xlsx" -o "租机登记表_标记版.xlsx"
```

### 场景2：定期更新

```powershell
# 每月更新时，直接运行
.\mark_customer.bat
```

### 场景3：处理历史数据

```powershell
# 处理多个历史文件
python mark_customer_type.py "2024年数据.xlsx" -o "2024年数据_已标记.xlsx"
python mark_customer_type.py "2025年数据.xlsx" -o "2025年数据_已标记.xlsx"
```

---

## ⚠️ 注意事项

### 运行前检查

- ✅ 确保Excel文件已关闭
- ✅ 确保C列（订单日期）和G列（身份证号）数据完整
- ✅ 建议先备份原文件

### 数据要求

- ✅ C列必须是Excel日期格式
- ✅ G列身份证号不能为空
- ✅ 至少需要20列（A-T列）

### 权限要求

- ✅ 对文件有读写权限
- ✅ 输出目录存在且可写

---

## 🔧 故障排除

### 问题1：找不到文件

**错误信息：**
```
✗ 错误: 当前目录未找到Excel文件
```

**解决方案：**
```powershell
# 方法1：指定完整路径
python mark_customer_type.py "C:\Users\...\租机登记表.xlsx"

# 方法2：切换到文件所在目录
cd "C:\Users\...\文件目录"
python mark_customer_type.py "租机登记表.xlsx"
```

### 问题2：列验证失败

**错误信息：**
```
✗ 列数不足，当前只有 15 列，需要至少20列
```

**解决方案：**
- 检查Excel文件是否有T列（第20列）
- 如果列位置不同，需要修改脚本中的列索引

### 问题3：日期解析错误

**解决方案：**
- 确保C列是Excel日期格式（不是文本）
- 在Excel中选中C列，设置为"日期"格式

### 问题4：保存失败

**错误信息：**
```
✗ 保存文件失败: Permission denied
```

**解决方案：**
- 关闭Excel文件
- 检查文件是否为只读
- 使用 `-o` 参数保存到新文件

---

## 📊 输出说明

### 控制台输出

```
============================================================
客户类型标记工具
============================================================
✓ 成功加载文件: 租机登记表.xlsx
  工作表: Sheet1
  数据行数: 1500

当前列名: [...]
✓ 列验证通过

使用的列:
  订单创建日期列 (C列): 订单创建日期
  客户身份证号列 (G列): 客户身份证号
  客户类型标记列 (T列): 客户类型

2025年之前的客户数量: 856

标记完成:
  新增客户订单: 124 条
  存量客户订单: 1376 条

✓ 格式应用完成
✓ 文件已保存: 租机登记表.xlsx

============================================================
处理完成！
============================================================

颜色说明:
  🟢 浅绿色 - 新增客户
  🟡 浅黄色 - 存量客户
```

### Excel输出

**T列内容：**
- 文字："新增" 或 "存量"
- 颜色：
  - 新增客户：浅绿色背景 (#C6EFCE)
  - 存量客户：浅黄色背景 (#FFEB9C)

---

## 📞 获取帮助

### 查看命令行帮助

```powershell
python mark_customer_type.py -h
```

### 查看详细文档

- 快速参考：`快速参考.txt`
- 详细说明：`客户类型标记说明.md`
- 文件说明：`客户类型标记_文件说明.md`
- 实现总结：`实现总结.md`

---

## 🎉 快速开始

**最简单的使用方式：**

```powershell
# 1. 确保 租机登记表.xlsx 在当前目录
# 2. 运行以下命令之一：

python mark_customer_type.py          # 自动查找文件
# 或
.\mark_customer.bat                   # 使用批处理文件
```

就这么简单！🚀

