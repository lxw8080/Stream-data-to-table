# 客户类型标记工具使用说明

## 功能概述

这个工具用于自动标记2025年的新增客户订单和存量客户订单。

## 业务逻辑

### 标记规则

1. **通过客户身份证号（G列）识别唯一客户**
2. **对于订单创建日期（C列）在2025年1月1日及以后的订单：**
   - 如果该客户的身份证号在2025年之前的订单中出现过 → 标记为 **"存量"**
   - 如果该客户的身份证号在2025年之前从未出现过 → 标记为 **"新增"**
3. **对于2025年之前的订单** → 标记为 **"存量"**

### 颜色标识

- 🟢 **浅绿色** - 新增客户
- 🟡 **浅黄色** - 存量客户

## 文件结构要求

- **文件名**: `租机登记表.xlsx`
- **工作表名**: `Sheet1`
- **第1行**: 标题行
- **第2行**: 表头行
- **第3行及以后**: 数据行

### 关键列说明

- **C列**: 订单创建日期
- **G列**: 客户身份证号
- **T列**: 客户类型标记（工具会在此列填写"新增"或"存量"）

## 使用方法

### 方法一：使用批处理文件（推荐）

1. 确保 `租机登记表.xlsx` 文件在当前目录
2. 双击运行 `mark_customer.bat`
3. 等待处理完成
4. 查看结果（原文件会被更新）

### 方法二：使用命令行

#### 基本用法（覆盖原文件）

```bash
python mark_customer_type.py 租机登记表.xlsx
```

#### 保存到新文件

```bash
python mark_customer_type.py 租机登记表.xlsx -o 标记结果.xlsx
```

#### 指定工作表名称

```bash
python mark_customer_type.py 租机登记表.xlsx -s Sheet1
```

#### 完整参数示例

```bash
python mark_customer_type.py 租机登记表.xlsx -s Sheet1 -o 标记结果.xlsx
```

## 命令行参数说明

| 参数 | 简写 | 说明 | 是否必需 | 默认值 |
|------|------|------|----------|--------|
| file | - | Excel文件路径 | 是 | - |
| --sheet | -s | 工作表名称 | 否 | Sheet1 |
| --output | -o | 输出文件路径 | 否 | 覆盖原文件 |

## 查看帮助信息

```bash
python mark_customer_type.py -h
```

## 处理流程

工具执行时会按以下步骤处理：

1. ✓ 加载Excel文件
2. ✓ 验证列结构
3. ✓ 分析2025年之前的客户数据
4. ✓ 标记客户类型（新增/存量）
5. ✓ 应用颜色格式
6. ✓ 保存文件

## 输出示例

```
============================================================
客户类型标记工具
============================================================
✓ 成功加载文件: 租机登记表.xlsx
  工作表: Sheet1
  数据行数: 1500

当前列名: [...]
✓ 列验证通过

使用的列:
  订单创建日期列 (C列): 订单创建日期
  客户身份证号列 (G列): 客户身份证号
  客户类型标记列 (T列): 客户类型

2025年之前的客户数量: 856

标记完成:
  新增客户订单: 124 条
  存量客户订单: 1376 条

✓ 格式应用完成
✓ 文件已保存: 租机登记表.xlsx

============================================================
处理完成！
============================================================

颜色说明:
  🟢 浅绿色 - 新增客户
  🟡 浅黄色 - 存量客户
```

## 注意事项

1. **备份数据**: 建议在运行工具前备份原始Excel文件
2. **文件格式**: 确保Excel文件格式正确，包含所需的列
3. **日期格式**: C列的日期应该是Excel可识别的日期格式
4. **身份证号**: G列的身份证号应该是文本或数字格式
5. **关闭文件**: 运行工具前请关闭Excel文件，否则可能无法保存

## 常见问题

### Q: 如何备份原文件？

A: 使用 `-o` 参数指定输出文件：
```bash
python mark_customer_type.py 租机登记表.xlsx -o 租机登记表_标记版.xlsx
```

### Q: 如果列的位置不对怎么办？

A: 工具会显示当前的列名，请检查：
- C列是否为订单创建日期
- G列是否为客户身份证号
- T列是否为要标记的列

如果列位置不对，需要调整Excel文件或修改脚本中的列索引。

### Q: 处理大文件需要多长时间？

A: 处理速度取决于数据量，通常：
- 1000行数据：约2-5秒
- 10000行数据：约10-30秒

### Q: 可以处理多个工作表吗？

A: 当前版本一次只能处理一个工作表。如需处理多个工作表，请多次运行工具并使用 `-s` 参数指定不同的工作表名称。

## 技术支持

如遇到问题，请检查：
1. Python环境是否正确安装
2. 依赖包是否已安装（pandas, openpyxl）
3. Excel文件格式是否符合要求
4. 文件路径是否正确

## 更新日志

### v1.0.0 (2025-01-07)
- 初始版本
- 支持自动标记新增/存量客户
- 支持颜色格式化
- 支持命令行参数

